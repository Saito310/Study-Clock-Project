<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Study Clock</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",
  "Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
  background:#fff;
  color:#222;
  width:100vw;
  height:100vh;
  overflow:hidden;
}

/* ===== メニュー ===== */
#menu-btn{
  position:fixed;
  top:20px;
  right:24px;
  font-size:28px;
  cursor:pointer;
  z-index:1001;
}
#sidebar{
  position:fixed;
  top:0;
  right:-280px;
  width:280px;
  height:100vh;
  background:#f7f7f7;
  box-shadow:-4px 0 12px rgba(0,0,0,.1);
  transition:right .3s ease;
  padding:30px 20px;
  z-index:1000;
}
#sidebar.open{right:0}
.menu-item{
  font-size:20px;
  padding:14px 0;
  border-bottom:1px solid #ddd;
  cursor:pointer;
}

/* ===== ページ ===== */
.page{display:none;width:100%;height:100%}
.page.active{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}

/* ===== 時計 ===== */
#time{font-size:18vw;font-weight:800}
#date{margin-top:20px;font-size:2.2vw;color:#444}
#sub{margin-top:6px;font-size:1.4vw;color:#777}

/* ===== 勉強管理 ===== */
.study-time{font-size:6vw;font-weight:bold;margin:20px 0}
.study-buttons button{font-size:20px;padding:12px 24px;margin:10px}
.total-time{margin-top:30px;font-size:1.6vw;color:#555}
</style>
</head>

<body>

<div id="menu-btn">☰</div>

<div id="sidebar">
  <div class="menu-item" data-page="clock">時間</div>
  <div class="menu-item" data-page="study">勉強管理</div>
</div>

<div id="clock" class="page active">
  <div id="time">00:00:00</div>
  <div id="date">----</div>
  <div id="sub">Study Clock</div>
</div>

<div id="study" class="page">
  <h1>勉強管理</h1>
  <div class="study-time" id="currentStudyTime">00:00:00</div>

  <div class="study-buttons">
    <button id="startBtn">▶ 開始</button>
    <button id="stopBtn">⏸ 停止</button>
  </div>

  <div class="total-time">
    今日の合計勉強時間：
    <span id="totalStudyTime">00:00:00</span>
  </div>
</div>

<script>
window.onload = () => {

  /* ===== DOM ===== */
  const menuBtn = document.getElementById("menu-btn");
  const sidebar = document.getElementById("sidebar");
  const pages = document.querySelectorAll(".page");

  const timeEl = document.getElementById("time");
  const dateEl = document.getElementById("date");

  const currentStudyTimeEl = document.getElementById("currentStudyTime");
  const totalStudyTimeEl = document.getElementById("totalStudyTime");

  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");

  /* ===== 時計 ===== */
  function updateClock(){
    const n=new Date();
    timeEl.textContent=
      String(n.getHours()).padStart(2,"0")+":"+
      String(n.getMinutes()).padStart(2,"0")+":"+
      String(n.getSeconds()).padStart(2,"0");
    const w=["日","月","火","水","木","金","土"][n.getDay()];
    dateEl.textContent=
      `${n.getFullYear()}年${n.getMonth()+1}月${n.getDate()}日 ${w}曜日`;
  }
  updateClock();
  setInterval(updateClock,1000);

  /* ===== メニュー ===== */
  menuBtn.onclick=()=>sidebar.classList.toggle("open");
  document.querySelectorAll(".menu-item").forEach(item=>{
    item.onclick=()=>{
      pages.forEach(p=>p.classList.remove("active"));
      document.getElementById(item.dataset.page).classList.add("active");
      sidebar.classList.remove("open");
    };
  });

  /* ===== 勉強管理 ===== */
  const KEY="study_time";
  let startTime=null;
  let timer=null;
  let totalSec=0;

  function today(){
    const d=new Date();
    return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
  }
  function format(sec){
    const h=String(Math.floor(sec/3600)).padStart(2,"0");
    const m=String(Math.floor(sec%3600/60)).padStart(2,"0");
    const s=String(sec%60).padStart(2,"0");
    return `${h}:${m}:${s}`;
  }

  function save(data){
    localStorage.setItem(KEY,JSON.stringify(data));
  }

  function load(){
    const data=JSON.parse(localStorage.getItem(KEY));
    if(!data||data.date!==today()){
      save({date:today(),total:0,studying:false,start:0});
      totalSec=0;
      return;
    }
    totalSec=data.total;
    totalStudyTimeEl.textContent=format(totalSec);

    if(data.studying){
      startTime=data.start;
      resume();
    }
  }

  function resume(){
  timer = setInterval(()=>{
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    currentStudyTimeEl.textContent = format(elapsed);
    totalStudyTimeEl.textContent = format(totalSec + elapsed);
  },1000);
}


  startBtn.onclick=()=>{
    if(timer) return;
    startTime=Date.now();
    resume();
    save({date:today(),total:totalSec,studying:true,start:startTime});
  };

  stopBtn.onclick=()=>{
    if(!timer) return;
    clearInterval(timer);
    timer=null;
    totalSec+=Math.floor((Date.now()-startTime)/1000);
    startTime=null;
    currentStudyTimeEl.textContent="00:00:00";
    totalStudyTimeEl.textContent=format(totalSec);
    save({date:today(),total:totalSec,studying:false,start:0});
  };

  load();

  /* ===== 自動保存（①＋②） ===== */
  setInterval(()=>{
    if(timer&&startTime){
      save({
        date:today(),
        total:totalSec,
        studying:true,
        start:startTime
      });
    }
  },3000);

  window.addEventListener("beforeunload",()=>{
    if(timer&&startTime){
      save({
        date:today(),
        total:totalSec,
        studying:true,
        start:startTime
      });
    }
  });

};
</script>

</body>
</html>
